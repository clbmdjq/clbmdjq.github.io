<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>PostgreSQLé—®é¢˜æ’æŸ¥</title>
    <url>/2025/07/20/Postgre/</url>
    <content><![CDATA[<h2 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h2><ul>
<li>åœ¨æ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥æ—¶ï¼Œé•¿æ—¶é—´æ— å“åº”ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> public.xx <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> xx;</span><br></pre></td></tr></table></figure>
<p>è¯¥è¡¨æ•°æ®é‡å¹¶ä¸å¤§ï¼ˆä»… 1569 æ¡ï¼‰ï¼Œä½†æ‰§è¡Œ <code>ALTER TABLE DROP COLUMN</code> å´è¿Ÿè¿Ÿä¸è¿”å›ï¼Œæ€€ç–‘è¢«é”æˆ–å­˜åœ¨é˜»å¡ã€‚</p>
<h2 id="äºŒã€æ’æŸ¥è¿‡ç¨‹"><a href="#äºŒã€æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="äºŒã€æ’æŸ¥è¿‡ç¨‹"></a>äºŒã€æ’æŸ¥è¿‡ç¨‹</h2><p>æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ SQL æŸ¥è¯¢ PostgreSQL ä¸­çš„é”ç­‰å¾…æƒ…å†µï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    l.pid,</span><br><span class="line">    a.usename,</span><br><span class="line">    l.mode,</span><br><span class="line">    l.granted,</span><br><span class="line">    a.query,</span><br><span class="line">    a.state,</span><br><span class="line">    a.wait_event_type,</span><br><span class="line">    a.wait_event</span><br><span class="line"><span class="keyword">FROM</span> pg_locks l</span><br><span class="line"><span class="keyword">JOIN</span> pg_stat_activity a <span class="keyword">ON</span> l.pid <span class="operator">=</span> a.pid</span><br><span class="line"><span class="keyword">WHERE</span> l.relation <span class="operator">=</span> <span class="string">&#x27;xx&#x27;</span>::regclass;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢ç»“æœåˆ†æï¼š"><a href="#æŸ¥è¯¢ç»“æœåˆ†æï¼š" class="headerlink" title="æŸ¥è¯¢ç»“æœåˆ†æï¼š"></a>æŸ¥è¯¢ç»“æœåˆ†æï¼š</h3><ul>
<li><code>granted = false</code>ï¼šè¯´æ˜è¯¥ä¼šè¯<strong>æ­£åœ¨ç­‰å¾…è·å–é”</strong>ï¼›</li>
<li>å‘ç° <code>ALTER TABLE</code> çš„è¯­å¥æ²¡æœ‰æˆåŠŸè·å–é”ï¼›</li>
<li>åŒæ—¶å­˜åœ¨å…¶ä»–å‡ ä¸ª <code>SELECT</code> è¯­å¥ï¼Œå®ƒä»¬è¢«åŒ…è£¹åœ¨æ˜¾å¼äº‹åŠ¡ï¼ˆ<code>BEGIN</code>ï¼‰ä¸­ï¼Œè¿™äº›äº‹åŠ¡<strong>æŒæœ‰äº†<code>ACCESS SHARE</code>å…±äº«é”</strong>ï¼›</li>
<li>è¿™äº›å…±äº«é”é˜»æ­¢äº† <code>ALTER TABLE</code> æ‰€éœ€çš„**æ’ä»–é”ï¼ˆ<code>ACCESS EXCLUSIVE</code>ï¼‰**è·å–ã€‚</li>
</ul>
<hr>
<h2 id="ä¸‰ã€é”æœºåˆ¶åŸç†ï¼ˆç®€è¦ï¼‰"><a href="#ä¸‰ã€é”æœºåˆ¶åŸç†ï¼ˆç®€è¦ï¼‰" class="headerlink" title="ä¸‰ã€é”æœºåˆ¶åŸç†ï¼ˆç®€è¦ï¼‰"></a>ä¸‰ã€é”æœºåˆ¶åŸç†ï¼ˆç®€è¦ï¼‰</h2><p>PostgreSQL å¯¹è¡¨æ“ä½œæœ‰ç²¾ç»†çš„é”ç­‰çº§åˆ’åˆ†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œç±»å‹</th>
<th>é”ç±»å‹ï¼ˆLock Modeï¼‰</th>
<th>æ˜¯å¦é˜»å¡å…¶ä»–æ“ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td><code>SELECT</code></td>
<td><code>ACCESS SHARE</code></td>
<td>ä¸å¤§å¤šæ•°æ“ä½œå…¼å®¹</td>
</tr>
<tr>
<td><code>SELECT FOR UPDATE</code></td>
<td><code>ROW SHARE</code></td>
<td>å…è®¸éƒ¨åˆ†å†™æ“ä½œ</td>
</tr>
<tr>
<td><code>INSERT/UPDATE/DELETE</code></td>
<td><code>ROW EXCLUSIVE</code></td>
<td>å…è®¸å¹¶å‘è¯»</td>
</tr>
<tr>
<td><code>ALTER TABLE</code></td>
<td><code>ACCESS EXCLUSIVE</code></td>
<td>é˜»å¡æ‰€æœ‰å…¶ä»–é”</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>é‡ç‚¹ï¼š<code>ALTER TABLE</code> éœ€è¦ <code>ACCESS EXCLUSIVE</code> é”ï¼Œä¼šé˜»å¡å…¶ä»–ä»»ä½•è®¿é—®è¯¥è¡¨çš„äº‹åŠ¡ã€‚</strong></p>
</blockquote>
<h3 id="ğŸ”’-ä¸ºä»€ä¹ˆä¼šé˜»å¡ï¼Ÿ"><a href="#ğŸ”’-ä¸ºä»€ä¹ˆä¼šé˜»å¡ï¼Ÿ" class="headerlink" title="ğŸ”’ ä¸ºä»€ä¹ˆä¼šé˜»å¡ï¼Ÿ"></a>ğŸ”’ ä¸ºä»€ä¹ˆä¼šé˜»å¡ï¼Ÿ</h3><p>å› ä¸ºå…¶ä»–äº‹åŠ¡ä¸­å­˜åœ¨æ˜¾å¼æˆ–éšå¼ <code>BEGIN</code>ï¼Œå³ä½¿åªæ˜¯ <code>SELECT</code>ï¼Œä¸€æ—¦åœ¨äº‹åŠ¡æœªæäº¤å‰æ‰§è¡Œï¼ŒPostgreSQL ä»ç„¶ä¼šç»´æŒå…±äº«é”ï¼ˆ<code>ACCESS SHARE</code>ï¼‰ï¼Œä»è€Œé˜»æ­¢ç»“æ„å˜æ›´ã€‚</p>
<hr>
<h2 id="å››ã€è§£å†³æ–¹æ¡ˆ"><a href="#å››ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å››ã€è§£å†³æ–¹æ¡ˆ"></a>å››ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="âœ…-ç¡®è®¤æŒæœ‰é”çš„ä¼šè¯"><a href="#âœ…-ç¡®è®¤æŒæœ‰é”çš„ä¼šè¯" class="headerlink" title="âœ… ç¡®è®¤æŒæœ‰é”çš„ä¼šè¯"></a>âœ… ç¡®è®¤æŒæœ‰é”çš„ä¼šè¯</h3><p>ä¸ºäº†æ›´ç›´è§‚æŸ¥çœ‹â€œè°é˜»å¡äº†è°â€ï¼Œä½¿ç”¨ä»¥ä¸‹ SQL æŸ¥çœ‹é˜»å¡é“¾</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> blocked_locks.pid     <span class="keyword">AS</span> blocked_pid,</span><br><span class="line">       blocked_activity.query <span class="keyword">AS</span> blocked_query,</span><br><span class="line">       blocking_locks.pid     <span class="keyword">AS</span> blocking_pid,</span><br><span class="line">       blocking_activity.query <span class="keyword">AS</span> blocking_query</span><br><span class="line"><span class="keyword">FROM</span> pg_locks blocked_locks</span><br><span class="line"><span class="keyword">JOIN</span> pg_stat_activity blocked_activity <span class="keyword">ON</span> blocked_activity.pid <span class="operator">=</span> blocked_locks.pid</span><br><span class="line"><span class="keyword">JOIN</span> pg_locks blocking_locks <span class="keyword">ON</span> blocking_locks.locktype <span class="operator">=</span> blocked_locks.locktype</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.database <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.database</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.relation <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.relation</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.page <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.page</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.tuple <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.tuple</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.virtualxid <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.virtualxid</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.transactionid <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.transactionid</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.classid <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.classid</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.objid <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.objid</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.objsubid <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">DISTINCT</span> <span class="keyword">FROM</span> blocked_locks.objsubid</span><br><span class="line">  <span class="keyword">AND</span> blocking_locks.pid <span class="operator">!=</span> blocked_locks.pid</span><br><span class="line"><span class="keyword">JOIN</span> pg_stat_activity blocking_activity <span class="keyword">ON</span> blocking_activity.pid <span class="operator">=</span> blocking_locks.pid;</span><br></pre></td></tr></table></figure>

<h3 id="âœ…-æ¸…ç†é˜»å¡æº"><a href="#âœ…-æ¸…ç†é˜»å¡æº" class="headerlink" title="âœ… æ¸…ç†é˜»å¡æº"></a>âœ… æ¸…ç†é˜»å¡æº</h3><ul>
<li><strong>æ–¹å¼ä¸€</strong>ï¼šè”ç³»å¯¹åº”ä¸šåŠ¡æ–¹ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨æœªæäº¤çš„é•¿äº‹åŠ¡ï¼›</li>
<li><strong>æ–¹å¼äºŒ</strong>ï¼šé€šè¿‡ <code>pg_terminate_backend(pid)</code> å¼ºåˆ¶ç»ˆæ­¢å¯¹åº”è¿›ç¨‹ï¼ˆâš ï¸ æœ‰é£é™©ï¼‰ï¼›</li>
<li><strong>æ–¹å¼ä¸‰</strong>ï¼šç­‰å¾…äº‹åŠ¡è‡ªåŠ¨æäº¤ï¼ˆè‹¥ä¸šåŠ¡æœ€ç»ˆä¼šæäº¤ï¼‰ï¼›</li>
<li><strong>æ–¹å¼å››</strong>ï¼šä¸šåŠ¡ä»£ç ä¸­é¿å… <code>SELECT</code> åé•¿æ—¶é—´ä¸æäº¤äº‹åŠ¡ã€‚</li>
</ul>
<hr>
<h2 id="äº”ã€ä¼˜åŒ–å»ºè®®"><a href="#äº”ã€ä¼˜åŒ–å»ºè®®" class="headerlink" title="äº”ã€ä¼˜åŒ–å»ºè®®"></a>äº”ã€ä¼˜åŒ–å»ºè®®</h2><ol>
<li><strong>DDL æ“ä½œå»ºè®®åœ¨ä½å³°æœŸæ‰§è¡Œ</strong>ï¼Œé¿å…ä¸šåŠ¡é«˜å¹¶å‘æ—¶å½±å“ï¼›</li>
<li><strong>SELECT ä¸è¦åœ¨äº‹åŠ¡ä¸­é•¿æ—¶é—´æŒ‚èµ·</strong>ï¼Œé¿å…æŒé”ï¼›</li>
<li>ä½¿ç”¨ <code>LOCK TABLE table_name IN ACCESS EXCLUSIVE MODE</code> é¢„æ¼”é”ï¼Œè§‚å¯Ÿæ˜¯å¦èƒ½ç«‹å³è·å¾—é”ï¼›</li>
<li>åˆ©ç”¨ <code>pg_stat_activity</code> å’Œ <code>pg_locks</code> å®æ—¶ç›‘æ§ç³»ç»Ÿçš„é”ç«äº‰ï¼›</li>
<li>è‹¥ä¸ºé¢‘ç¹æ‰§è¡Œçš„ DDL æ“ä½œï¼Œè€ƒè™‘åˆ†åº“åˆ†è¡¨è®¾è®¡æˆ–æå‰ä¸‹çº¿æœåŠ¡çª—å£ã€‚</li>
</ol>
<hr>
<h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>è™½ç„¶è¡¨æ•°æ®é‡ä¸å¤§ï¼Œä½†ç»“æ„å˜æ›´æ¶‰åŠçš„é”ç²’åº¦å¾ˆå¤§ï¼Œä»»ä½•æœªæäº¤çš„äº‹åŠ¡ä¸­å¯¹ç›®æ ‡è¡¨çš„è®¿é—®éƒ½ä¼šé˜»å¡æ‰ DDL æ“ä½œ</p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
        <tag>é”è¡¨</tag>
        <tag>SQLä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2025/07/05/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
</search>
